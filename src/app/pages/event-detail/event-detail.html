<div class="event-detail-container p-4">
  <p-toast></p-toast>
  <p-confirmDialog></p-confirmDialog>

  <!-- Header with Back Button -->
  <div class="detail-header mb-4">
    <button 
      pButton 
      type="button" 
      icon="pi pi-arrow-left" 
      label="Volver a Eventos"
      class="p-button-text p-button-secondary"
      (click)="goBack()"
    ></button>
  </div>

  <!-- Loading State -->
  <div *ngIf="loading" class="loading-state">
    <i class="pi pi-spin pi-spinner" style="font-size: 3rem; color: #3b82f6;"></i>
    <p class="mt-3 text-gray-400">Cargando detalles...</p>
  </div>

  <!-- Event Detail Card -->
  <div *ngIf="!loading && event" class="detail-card">
    <div class="card-header">
      <div class="header-content">
        <div class="title-section">
          <h1 class="detail-title">
            <i class="pi pi-file-edit mr-3"></i>
            Detalle de Tarea
          </h1>
          <span [class]="event.completada ? 'status-badge status-complete' : 'status-badge status-pending'">
            <i [class]="event.completada ? 'pi pi-check-circle' : 'pi pi-clock'"></i>
            {{ event.completada ? 'Completada' : 'Pendiente' }}
          </span>
        </div>
        <div class="action-buttons-header">
          <button 
            *ngIf="!editMode"
            pButton 
            type="button" 
            icon="pi pi-pencil" 
            label="Editar"
            class="p-button-outlined p-button-info"
            (click)="toggleEditMode()"
          ></button>
          <button 
            pButton 
            type="button" 
            [icon]="event.completada ? 'pi pi-times-circle' : 'pi pi-check'" 
            [label]="event.completada ? 'Marcar Pendiente' : 'Completar Tarea'"
            [class]="event.completada ? 'p-button-warning' : 'p-button-success'"
            (click)="toggleComplete()"
          ></button>
          <button 
            pButton 
            type="button" 
            icon="pi pi-trash" 
            label="Eliminar"
            class="p-button-danger"
            (click)="deleteEvent()"
          ></button>
        </div>
      </div>
    </div>

    <div class="card-body">
      <!-- View Mode -->
      <div *ngIf="!editMode" class="view-mode">
        <div class="info-section">
          <div class="info-item">
            <label class="info-label">
              <i class="pi pi-hashtag mr-2"></i>
              ID
            </label>
            <p class="info-value">{{ event.id }}</p>
          </div>

          <div class="info-item">
            <label class="info-label">
              <i class="pi pi-bookmark mr-2"></i>
              Título
            </label>
            <p class="info-value">{{ event.titulo }}</p>
          </div>

          <div class="info-item full-width">
            <label class="info-label">
              <i class="pi pi-align-left mr-2"></i>
              Descripción
            </label>
            <p class="info-value description">{{ event.descripcion }}</p>
          </div>

          <div class="info-item">
            <label class="info-label">
              <i class="pi pi-calendar mr-2"></i>
              Fecha
            </label>
            <p class="info-value">{{ event.fecha | date:'dd/MM/yyyy' }}</p>
          </div>

          <div class="info-item" *ngIf="event.hora">
            <label class="info-label">
              <i class="pi pi-clock mr-2"></i>
              Hora
            </label>
            <p class="info-value">{{ event.hora }}</p>
          </div>

          <div class="info-item">
            <label class="info-label">
              <i class="pi pi-bell mr-2"></i>
              Notificación
            </label>
            <p class="info-value">
              <span [class]="event.notificar ? 'notify-badge notify-active' : 'notify-badge notify-inactive'">
                <i [class]="event.notificar ? 'pi pi-bell' : 'pi pi-bell-slash'"></i>
                {{ event.notificar ? 'Activa' : 'Inactiva' }}
              </span>
            </p>
          </div>
        </div>
      </div>

      <!-- Edit Mode -->
      <div *ngIf="editMode" class="edit-mode">
        <div class="form-grid">
          <div class="form-field full-width">
            <label for="titulo" class="field-label">
              <i class="pi pi-bookmark mr-2"></i>
              Título *
            </label>
            <input 
              id="titulo" 
              type="text" 
              pInputText 
              [(ngModel)]="event.titulo"
              class="w-full"
            />
          </div>

          <div class="form-field full-width">
            <label for="descripcion" class="field-label">
              <i class="pi pi-align-left mr-2"></i>
              Descripción *
            </label>
            <textarea 
              id="descripcion" 
              rows="5" 
              pTextarea
              [(ngModel)]="event.descripcion"
              class="w-full"
            ></textarea>
          </div>

          <div class="form-field">
            <label for="fecha" class="field-label">
              <i class="pi pi-calendar mr-2"></i>
              Fecha y Hora *
            </label>
            <p-datepicker 
              id="fecha" 
              [(ngModel)]="event.fecha"
              [showTime]="true"
              dateFormat="dd/mm/yy"
              [showIcon]="true"
              [fluid]="true"
            />
          </div>

          <div class="form-field">
            <label class="field-label">
              <i class="pi pi-bell mr-2"></i>
              Notificación
            </label>
            <div class="flex align-items-center mt-2">
              <p-checkbox 
                [(ngModel)]="event.notificar"
                [binary]="true"
                inputId="notificar"
              ></p-checkbox>
              <label for="notificar" class="ml-2 cursor-pointer">Activar notificación</label>
            </div>
          </div>
        </div>

        <div class="edit-actions">
          <button 
            pButton 
            type="button" 
            icon="pi pi-times" 
            label="Cancelar"
            class="p-button-text p-button-secondary"
            (click)="toggleEditMode()"
          ></button>
          <button 
            pButton 
            type="button" 
            icon="pi pi-check" 
            label="Guardar Cambios"
            class="p-button-success"
            (click)="saveChanges()"
          ></button>
        </div>
      </div>
    </div>
  </div>
</div>
