<div class="events-container p-4">
  <p-toast></p-toast>

  <!-- Header Section -->
  <div class="header-section mb-6">
    <div class="header-content">
      <div class="title-wrapper">
        <i class="pi pi-calendar text-3xl text-blue-400 mb-2"></i>
        <h1 class="page-title">Gestión de Eventos</h1>
        <p class="page-subtitle">Administra y organiza tus tareas y eventos pendientes</p>
      </div>
      <div class="action-wrapper">
        <button 
          pButton 
          type="button" 
          label="Nueva Tarea" 
          icon="pi pi-plus" 
          class="p-button-success p-button-lg shadow-lg"
          (click)="showCreateDialog()"
        ></button>
      </div>
    </div>
  </div>

  <!-- Table Card -->
  <div class="table-card">
    <p-table
      [value]="events"
      [loading]="loading"
      responsiveLayout="stack"
      breakpoint="960px"
      styleClass="modern-table"
      [paginator]="true"
      [rows]="rows"
      [totalRecords]="totalRecords"
      [lazy]="true"
      (onLazyLoad)="onLazyLoad($event)"
      [showCurrentPageReport]="true"
      currentPageReportTemplate="Mostrando {first} a {last} de {totalRecords} eventos"
      [rowsPerPageOptions]="[10, 25, 50]"
    >
      <ng-template pTemplate="header">
        <tr>
          <th class="table-header" style="width: 80px">
            <div class="flex align-items-center">
              <i class="pi pi-hashtag mr-2"></i>
              <span>ID</span>
            </div>
          </th>
          <th class="table-header">
            <div class="flex align-items-center">
              <i class="pi pi-bookmark mr-2"></i>
              <span>Título</span>
            </div>
          </th>
          <th class="table-header">
            <div class="flex align-items-center">
              <i class="pi pi-align-left mr-2"></i>
              <span>Descripción</span>
            </div>
          </th>
          <th class="table-header" style="width: 180px">
            <div class="flex align-items-center">
              <i class="pi pi-calendar mr-2"></i>
              <span>Fecha y Hora</span>
            </div>
          </th>
          <th class="table-header text-center" style="width: 130px">
            <div class="flex align-items-center justify-content-center">
              <i class="pi pi-check-circle mr-2"></i>
              <span>Estado</span>
            </div>
          </th>
          <th class="table-header text-center" style="width: 130px">
            <div class="flex align-items-center justify-content-center">
              <i class="pi pi-bell mr-2"></i>
              <span>Notificar</span>
            </div>
          </th>
          <th class="table-header text-center" style="width: 100px">
            <div class="flex align-items-center justify-content-center">
              <i class="pi pi-cog mr-2"></i>
              <span>Acciones</span>
            </div>
          </th>
        </tr>
      </ng-template>
      
      <ng-template pTemplate="body" let-event>
        <tr class="table-row" (click)="viewDetail(event.id)">
          <td>
            <span class="p-column-title">ID</span>
            <span class="event-id">{{ event.id }}</span>
          </td>
          <td>
            <span class="p-column-title">Título</span>
            <div class="event-title">
              <i class="pi pi-file text-blue-400 mr-2"></i>
              {{ event.titulo }}
            </div>
          </td>
          <td>
            <span class="p-column-title">Descripción</span>
            <div class="event-description">{{ event.descripcion }}</div>
          </td>
          <td>
            <span class="p-column-title">Fecha y Hora</span>
            <div class="event-datetime">
              <div class="date-info">
                <i class="pi pi-calendar-plus text-purple-400 mr-2"></i>
                {{ event.fecha | date:'dd/MM/yyyy' }}
              </div>
              <div class="time-info" *ngIf="event.hora">
                <i class="pi pi-clock text-cyan-400 mr-2"></i>
                {{ event.hora }}
              </div>
            </div>
          </td>
          <td class="text-center">
            <span class="p-column-title">Estado</span>
            <span [class]="event.completada ? 'status-badge status-complete' : 'status-badge status-pending'">
              <i [class]="event.completada ? 'pi pi-check-circle' : 'pi pi-clock'"></i>
              {{ event.completada ? 'Completada' : 'Pendiente' }}
            </span>
          </td>
          <td class="text-center">
            <span class="p-column-title">Notificar</span>
            <span [class]="event.notificar ? 'notify-badge notify-active' : 'notify-badge notify-inactive'">
              <i [class]="event.notificar ? 'pi pi-bell' : 'pi pi-bell-slash'"></i>
              {{ event.notificar ? 'Activa' : 'Inactiva' }}
            </span>
          </td>
          <td class="text-center">
            <span class="p-column-title">Acciones</span>
            <div class="action-buttons" (click)="$event.stopPropagation()">
              <button 
                pButton 
                type="button" 
                icon="pi pi-trash" 
                class="p-button-rounded p-button-danger p-button-sm"
                (click)="deleteEvent(event.id)"
                pTooltip="Eliminar tarea"
                tooltipPosition="top"
              ></button>
            </div>
          </td>
        </tr>
      </ng-template>
      
      <ng-template pTemplate="emptymessage">
        <tr>
          <td colspan="7">
            <div class="empty-state">
              <i class="pi pi-inbox empty-icon"></i>
              <h3 class="empty-title">No hay eventos disponibles</h3>
              <p class="empty-message">Comienza creando tu primera tarea haciendo clic en "Nueva Tarea"</p>
            </div>
          </td>
        </tr>
      </ng-template>
    </p-table>
  </div>

  <!-- Modal para crear nueva tarea -->
  <p-dialog 
    header="Crear Nueva Tarea" 
    [(visible)]="displayModal" 
    [modal]="true" 
    [style]="{width: '500px'}" 
    [draggable]="false" 
    [resizable]="false"
    styleClass="custom-dialog"
  >
    <div class="p-fluid">
      <div class="field mb-4">
        <label for="titulo" class="block text-white font-semibold mb-2">Título *</label>
        <input 
          id="titulo" 
          type="text" 
          pInputText 
          [(ngModel)]="newEvent.titulo" 
          placeholder="Ingrese el título de la tarea"
          class="w-full"
          required
        />
      </div>

      <div class="field mb-4">
        <label for="descripcion" class="block text-white font-semibold mb-2">Descripción *</label>
        <textarea 
          id="descripcion" 
          rows="4" 
          pTextarea
          [(ngModel)]="newEvent.descripcion" 
          placeholder="Ingrese la descripción de la tarea"
          class="w-full"
          required
        ></textarea>
      </div>

      <div class="field mb-4">
        <label for="fecha" class="block text-white font-semibold mb-2">Fecha *</label>
        <p-datepicker 
          id="fecha" 
          [(ngModel)]="newEvent.fecha" 
          [showTime]="true" 
          dateFormat="dd/mm/yy" 
          [showIcon]="true"
          placeholder="Seleccione fecha y hora"
          [fluid]="true"
        />
      </div>

      <div class="field mb-4">
        <div class="flex align-items-center">
          <p-checkbox 
            id="notificar" 
            [(ngModel)]="newEvent.notificar" 
            [binary]="true"
            inputId="notificar"
          ></p-checkbox>
          <label for="notificar" class="ml-2 text-white cursor-pointer">Recibir notificación</label>
        </div>
      </div>
    </div>

    <ng-template pTemplate="footer">
      <button 
        pButton 
        type="button" 
        label="Cancelar" 
        icon="pi pi-times" 
        class="p-button-text p-button-secondary"
        (click)="hideDialog()"
      ></button>
      <button 
        pButton 
        type="button" 
        label="Crear Tarea" 
        icon="pi pi-check" 
        class="p-button-success"
        (click)="createEvent()"
      ></button>
    </ng-template>
  </p-dialog>
</div>